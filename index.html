<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÁôΩÁßò‰ºùË®àÁÆó„ÉÑ„Éº„É´ (WebÁâà)</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <header class="app-header">
            <div class="logo">
                <span class="material-icons-round">auto_awesome</span>
                <h1>ÁôΩÁßò‰ºùË®àÁÆó (Web)</h1>
            </div>
            <nav class="app-nav">
                <button class="nav-btn active" data-tab="tab-calc">
                    <span class="material-icons-round">calculate</span>
                    Ë®àÁÆó
                </button>
                <button class="nav-btn" data-tab="tab-family">
                    <span class="material-icons-round">family_restroom</span>
                    ÊâÄÊåÅÁßò‰ºù
                </button>
                <button class="nav-btn" data-tab="tab-def">
                    <span class="material-icons-round">edit_note</span>
                    ÂÆöÁæ©
                </button>
                <button class="nav-btn" data-tab="tab-history">
                    <span class="material-icons-round">history</span>
                    Â±•Ê≠¥
                </button>
            </nav>
        </header>

        <main class="app-content">
            <!-- TAB: Calculation -->
            <section id="tab-calc" class="tab-content active">
                <div class="card">
                    <div class="header-with-action" style="display:flex; justify-content:space-between; align-items:center;">
                        <h2>ÁõÆÊ®ô„Çπ„ÉÜ„Éº„Çø„ÇπË®≠ÂÆö</h2>
                        <button class="secondary-btn small-btn" id="btn-clear-target">
                            <span class="material-icons-round">backspace</span>
                            „ÇØ„É™„Ç¢
                        </button>
                    </div>
                    <div class="form-grid target-stats-grid">
                        <div class="input-group">
                            <label>„É©„Ç§„Éï</label>
                            <input type="number" id="target-life" class="stat-input" placeholder="0">
                        </div>
                        <div class="input-group">
                            <label>„Å°„Åã„Çâ</label>
                            <input type="number" id="target-pow" class="stat-input" placeholder="0">
                        </div>
                        <div class="input-group">
                            <label>„Åã„Åó„Åì„Åï</label>
                            <input type="number" id="target-int" class="stat-input" placeholder="0">
                        </div>
                        <div class="input-group">
                            <label>ÂëΩ‰∏≠</label>
                            <input type="number" id="target-ski" class="stat-input" placeholder="0">
                        </div>
                        <div class="input-group">
                            <label>ÂõûÈÅø</label>
                            <input type="number" id="target-spd" class="stat-input" placeholder="0">
                        </div>
                        <div class="input-group">
                            <label>‰∏àÂ§´„Åï</label>
                            <input type="number" id="target-def" class="stat-input" placeholder="0">
                        </div>
                        <div class="input-group">
                            <label>ËÉΩÂäõpt</label>
                            <input type="number" id="target-pt" class="stat-input" placeholder="0">
                        </div>
                        <div class="input-group full-width">
                            <label>Áõ∏ÊÄßÂÄçÁéá</label>
                            <select id="compatibility-ratio" class="select-input">
                                <option value="1.3">üëë‚ú® 1.30</option>
                                <option value="1.25">üëë 1.25</option>
                                <option value="1.2">‚òÜ 1.20</option>
                                <option value="1.15">‚óé 1.15</option>
                                <option value="1.1">‚óã 1.10</option>
                                <option value="1.05">‚ñ≥ 1.05</option>
                                <option value="1.0">√ó 1.00</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>ÈùíÁßò‰ºùÊï∞ÂÄ§Ë®≠ÂÆö</h2>
                    <div class="form-grid blue-stats-grid">
                        <div class="input-group"><label>„É©„Ç§„Éï</label><input type="number" id="blue-life"
                                class="stat-input" placeholder="0"></div>
                        <div class="input-group"><label>„Å°„Åã„Çâ</label><input type="number" id="blue-pow" class="stat-input"
                                placeholder="0"></div>
                        <div class="input-group"><label>„Åã„Åó„Åì„Åï</label><input type="number" id="blue-int"
                                class="stat-input" placeholder="0"></div>
                        <div class="input-group"><label>ÂëΩ‰∏≠</label><input type="number" id="blue-ski" class="stat-input"
                                placeholder="0"></div>
                        <div class="input-group"><label>ÂõûÈÅø</label><input type="number" id="blue-spd" class="stat-input"
                                placeholder="0"></div>
                        <div class="input-group"><label>‰∏àÂ§´„Åï</label><input type="number" id="blue-def" class="stat-input"
                                placeholder="0"></div>
                    </div>
                </div>

                <div class="action-area" style="display: flex; gap: 1rem;">
                    <button id="btn-calculate" class="primary-btn">
                        <span class="material-icons-round">play_arrow</span>
                        Ë®àÁÆóÂÆüË°å
                    </button>
                    <button id="btn-cancel" class="secondary-btn hidden">
                        <span class="material-icons-round">stop</span>
                        „Ç≠„É£„É≥„Çª„É´
                    </button>
                </div>

                <div id="result-area" class="card result-card hidden">
                    <h3>Ë®àÁÆóÁµêÊûú</h3>
                    <div class="result-actions">
                        <button id="btn-copy" class="secondary-btn small-btn">„ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å´„Ç≥„Éî„Éº</button>
                    </div>
                    <pre id="result-text"></pre> <!-- For raw text copy -->
                    <div id="result-html"></div> <!-- For visual display -->
                </div>
            </section>

            <!-- TAB: Family Tree (Owned Secrets) -->
            <section id="tab-family" class="tab-content">
                <div class="family-tree-container">
                    <!-- 6 Family Members -->
                    <div class="family-member-card" data-member="father">
                        <h3>Áà∂Ë¶™</h3>
                        <div class="secret-list" id="list-father"></div>
                        <button class="add-secret-btn" onclick="addSecretToMember('father')">+ Áßò‰ºùËøΩÂä†</button>
                    </div>
                    <div class="family-member-card" data-member="f-gf">
                        <h3>Áà∂ÊñπÁ•ñÁà∂</h3>
                        <div class="secret-list" id="list-f-gf"></div>
                        <button class="add-secret-btn" onclick="addSecretToMember('f-gf')">+ Áßò‰ºùËøΩÂä†</button>
                    </div>
                    <div class="family-member-card" data-member="f-gm">
                        <h3>Áà∂ÊñπÁ•ñÊØç</h3>
                        <div class="secret-list" id="list-f-gm"></div>
                        <button class="add-secret-btn" onclick="addSecretToMember('f-gm')">+ Áßò‰ºùËøΩÂä†</button>
                    </div>
                    <div class="family-member-card" data-member="mother">
                        <h3>ÊØçË¶™</h3>
                        <div class="secret-list" id="list-mother"></div>
                        <button class="add-secret-btn" onclick="addSecretToMember('mother')">+ Áßò‰ºùËøΩÂä†</button>
                    </div>
                    <div class="family-member-card" data-member="m-gf">
                        <h3>ÊØçÊñπÁ•ñÁà∂</h3>
                        <div class="secret-list" id="list-m-gf"></div>
                        <button class="add-secret-btn" onclick="addSecretToMember('m-gf')">+ Áßò‰ºùËøΩÂä†</button>
                    </div>
                    <div class="family-member-card" data-member="m-gm">
                        <h3>ÊØçÊñπÁ•ñÊØç</h3>
                        <div class="secret-list" id="list-m-gm"></div>
                        <button class="add-secret-btn" onclick="addSecretToMember('m-gm')">+ Áßò‰ºùËøΩÂä†</button>
                    </div>
                </div>
                <!-- Controls for Family Data -->
                <div class="card" style="margin-top: 1rem;">
                    <h3>„Éá„Éº„ÇøÁÆ°ÁêÜ</h3>
                    <div class="history-controls">
                        <button class="secondary-btn small-btn" onclick="resetFamilyData()">
                            <span class="material-icons-round">delete_sweep</span>
                            ÂÖ®‰∏ñ‰ª£„ÅÆÊâÄÊåÅÁä∂Ê≥Å„Çí„ÇØ„É™„Ç¢
                        </button>
                        <button class="secondary-btn small-btn" onclick="exportFamilyData()">
                            <span class="material-icons-round">download</span>
                            ÊâÄÊåÅÁä∂Ê≥Å„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà
                        </button>
                        <button class="secondary-btn small-btn"
                            onclick="document.getElementById('import-family-file').click()">
                            <span class="material-icons-round">upload</span>
                            ÊâÄÊåÅÁä∂Ê≥Å„Çí„Ç§„É≥„Éù„Éº„Éà
                        </button>
                        <input type="file" id="import-family-file" accept=".json" style="display: none;"
                            onchange="importFamilyData(this)">
                    </div>
                </div>
            </section>

            <!-- TAB: White Secret Definitions -->
            <section id="tab-def" class="tab-content">
                <div class="card">
                    <div class="header-with-action">
                        <h2>ÁôΩÁßò‰ºùÂÆöÁæ©</h2>
                        <div class="def-actions" style="display: flex; gap: 0.5rem;">
                            <button class="secondary-btn small-btn" onclick="exportDefinitions()">
                                <span class="material-icons-round">download</span>
                                „Ç®„ÇØ„Çπ„Éù„Éº„Éà
                            </button>
                            <button class="secondary-btn small-btn"
                                onclick="document.getElementById('import-def-file').click()">
                                <span class="material-icons-round">upload</span>
                                „Ç§„É≥„Éù„Éº„Éà
                            </button>
                            <input type="file" id="import-def-file" accept=".json" style="display: none;"
                                onchange="importDefinitions(this)">
                            <button class="secondary-btn" onclick="openDefModal()">+ Êñ∞Ë¶èÂÆöÁæ©</button>
                        </div>
                    </div>
                    <div class="table-wrapper">
                        <table class="data-table" id="def-table">
                            <thead>
                                <tr>
                                    <th>Áßò‰ºùÂêç</th>
                                    <th>„Çπ„ÉÜ„Éº„Çø„ÇπË©≥Á¥∞</th>
                                    <th>Êìç‰Ωú</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Rows generated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- TAB: History -->
            <section id="tab-history" class="tab-content">
                <div class="card">
                    <h2>Ë®àÁÆóÂ±•Ê≠¥</h2>
                    <div class="history-controls">
                        <button class="secondary-btn small-btn" id="btn-reset-history">
                            <span class="material-icons-round">delete_outline</span>
                            Â±•Ê≠¥„ÇíÂÖ®ÂâäÈô§
                        </button>
                        <button class="secondary-btn small-btn" onclick="exportHistoryData()">
                            <span class="material-icons-round">download</span>
                            Â±•Ê≠¥„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà
                        </button>
                        <button class="secondary-btn small-btn" onclick="document.getElementById('import-history-file').click()">
                            <span class="material-icons-round">upload</span>
                            Â±•Ê≠¥„Çí„Ç§„É≥„Éù„Éº„Éà
                        </button>
                        <input type="file" id="import-history-file" accept=".json" style="display: none;" onchange="importHistoryData(this)">
                        <button class="primary-btn small-btn" id="btn-copy-history">
                            <span class="material-icons-round">content_copy</span>
                            ÁµêÊûú„Çí„Ç≥„Éî„Éº (TSV)
                        </button>
                    </div>
                    <div class="history-table-container">
                        <table class="history-table" id="history-table">
                            <!-- Dynamic Content -->
                        </table>
                        <div id="history-empty-msg" class="empty-msg" style="display:none;">
                            Â±•Ê≠¥„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì
                        </div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- Modal for Definition (Add/Edit) -->
    <div id="def-modal" class="modal hidden">
        <div class="modal-content large-modal">
            <h3>Áßò‰ºùÂÆöÁæ©Á∑®ÈõÜ</h3>
            <div class="modal-form"> <!-- Wrapper for scrolling -->
                <div class="form-grid">
                    <div class="input-group full-width">
                        <label>Áßò‰ºùÂêç</label>
                        <input type="text" id="def-name" placeholder="‰æã: ÂÇ∑„Å†„Çâ„Åë„ÅÆ„Éó„É©„Ç§„ÉâÁßò‰ºù">
                        <label class="checkbox-label"
                            style="display:flex; align-items:center; gap:0.5rem; margin-top:0.5rem; cursor:pointer;">
                            <input type="checkbox" id="def-is-exception"> <span style="font-size:0.9rem;">ÈõÜË®à„Åã„ÇâÈô§Â§ñ
                                (‰æãÂ§ñ)</span>
                        </label>
                    </div>

                    <div class="stat-rows-container">
                        <label>„Çπ„ÉÜ„Éº„Çø„ÇπÂÆöÁæ©</label>
                        <div id="def-stat-rows">
                            <!-- Stat Rows injected here -->
                        </div>
                        <button class="rich-add-btn" onclick="addStatRow()">
                            <span class="material-icons-round">add_circle_outline</span>
                            „Çπ„ÉÜ„Éº„Çø„ÇπË°å„ÇíËøΩÂä†
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="secondary-btn" onclick="closeModal('def-modal')">„Ç≠„É£„É≥„Çª„É´</button>
                <button class="primary-btn" onclick="saveDefinition()">‰øùÂ≠ò</button>
            </div>
        </div>
    </div>

    <!-- Modal for Adding Possessed Secret -->
    <div id="add-secret-modal" class="modal hidden">
        <div class="modal-content">
            <h3>ÊâÄÊåÅÁßò‰ºù„ÇíËøΩÂä†</h3>
            <div class="form-grid modal-form">
                <div class="input-group full-width">
                    <label>Áßò‰ºù„ÇíÈÅ∏Êäû</label>
                    <select id="add-secret-select" class="select-input">
                        <!-- Populated by JS -->
                    </select>
                </div>

                <div class="input-group full-width">
                    <label>„É©„É≥„ÇØ (‚òÖ)</label>
                    <div class="star-rating-widget">
                        <span class="material-icons-round star-icon" onclick="selectStarNew(1)" id="star-1">star</span>
                        <span class="material-icons-round star-icon" onclick="selectStarNew(2)" id="star-2">star</span>
                        <span class="material-icons-round star-icon" onclick="selectStarNew(3)" id="star-3">star</span>
                    </div>
                    <input type="hidden" id="add-secret-star" value="3">
                </div>
            </div>
            <div class="modal-actions">
                <button class="secondary-btn" onclick="closeModal('add-secret-modal')">„Ç≠„É£„É≥„Çª„É´</button>
                <button class="primary-btn" onclick="confirmAddSecret()">ËøΩÂä†</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>